<deploymentModule category="Deployment" creation="2013-11-08 14:49:25.427 CET" deleted="false" description="simple, single node deployment of WordPress" lastModified="2013-11-16 08:33:42.551 CET" parentUri="module/examples/tutorials/wordpress" shortName="wordpress" version="304">
   <parameters class="org.hibernate.collection.PersistentMap" />
   <authz groupCreateChildren="false" groupDelete="false" groupGet="false" groupPost="false" groupPut="false" inheritedGroupMembers="true" owner="sixsq" ownerCreateChildren="true" ownerDelete="true" ownerGet="true" ownerPost="true" ownerPut="true" publicCreateChildren="false" publicDelete="false" publicGet="false" publicPost="false" publicPut="false">
      <groupMembers class="java.util.ArrayList" />
   </authz>
   <commit author="sixsq">
      <comment />
   </commit>
   <cloudNames length="4">
      <string>stratuslab</string>
      <string>LLR</string>
      <string>CC-IN2P3</string>
      <string>default</string>
   </cloudNames>
   <runs />
   <nodes class="org.hibernate.collection.PersistentMap">
      <entry>
         <string>wp</string>
         <node cloudService="stratuslab" creation="2013-11-15 13:47:49.339 CET" deleted="false" imageUri="module/examples/tutorials/wordpress/wordpress-appliance" multiplicity="1" name="wp" network="Public">
            <parameters class="org.hibernate.collection.PersistentMap">
               <entry>
                  <string>mysql_password</string>
                  <parameter category="General" class="com.sixsq.slipstream.persistence.NodeParameter" description="" isMappedValue="false" mandatory="false" name="mysql_password" readonly="false" type="String">
                     <value>'ChangeMe'</value>
                  </parameter>
               </entry>
               <entry>
                  <string>admin_password</string>
                  <parameter category="General" class="com.sixsq.slipstream.persistence.NodeParameter" description="" isMappedValue="false" mandatory="false" name="admin_password" readonly="false" type="String">
                     <value>'ChangeMe'</value>
                  </parameter>
               </entry>
               <entry>
                  <string>wordpress_title</string>
                  <parameter category="General" class="com.sixsq.slipstream.persistence.NodeParameter" description="" isMappedValue="false" mandatory="false" name="wordpress_title" readonly="false" type="String">
                     <value>'ChangeMe'</value>
                  </parameter>
               </entry>
               <entry>
                  <string>admin_email</string>
                  <parameter category="General" class="com.sixsq.slipstream.persistence.NodeParameter" description="" isMappedValue="false" mandatory="false" name="admin_email" readonly="false" type="String">
                     <value>'admin@example.com'</value>
                  </parameter>
               </entry>
               <entry>
                  <string>admin_username</string>
                  <parameter category="General" class="com.sixsq.slipstream.persistence.NodeParameter" description="" isMappedValue="false" mandatory="false" name="admin_username" readonly="false" type="String">
                     <value>'admin'</value>
                  </parameter>
               </entry>
            </parameters>
            <parameterMappings class="org.hibernate.collection.PersistentMap">
               <entry>
                  <string>mysql_password</string>
                  <nodeParameter category="General" description="" isMappedValue="false" mandatory="false" name="mysql_password" readonly="false" type="String">
                     <value>'ChangeMe'</value>
                  </nodeParameter>
               </entry>
               <entry>
                  <string>admin_password</string>
                  <nodeParameter category="General" description="" isMappedValue="false" mandatory="false" name="admin_password" readonly="false" type="String">
                     <value>'ChangeMe'</value>
                  </nodeParameter>
               </entry>
               <entry>
                  <string>wordpress_title</string>
                  <nodeParameter category="General" description="" isMappedValue="false" mandatory="false" name="wordpress_title" readonly="false" type="String">
                     <value>'ChangeMe'</value>
                  </nodeParameter>
               </entry>
               <entry>
                  <string>admin_email</string>
                  <nodeParameter category="General" description="" isMappedValue="false" mandatory="false" name="admin_email" readonly="false" type="String">
                     <value>'admin@example.com'</value>
                  </nodeParameter>
               </entry>
               <entry>
                  <string>admin_username</string>
                  <nodeParameter category="General" description="" isMappedValue="false" mandatory="false" name="admin_username" readonly="false" type="String">
                     <value>'admin'</value>
                  </nodeParameter>
               </entry>
            </parameterMappings>
            <image category="Image" creation="2013-11-16 08:43:14.5 CET" deleted="false" description="installs and configures WordPress using Puppet" imageId="KBhcU87Wm5IZNOXZYGHrczGekwp" isBase="false" lastModified="2013-11-16 08:43:14.25 CET" loginUser="root" moduleReferenceUri="module/examples/images/ubuntu-12.04" name="examples/tutorials/wordpress/wordpress-appliance" parentUri="module/examples/tutorials/wordpress" platform="ubuntu" shortName="wordpress-appliance" version="313">
               <parameters class="org.hibernate.collection.PersistentMap">
                  <entry>
                     <string>stratuslab.disks.bus.type</string>
                     <parameter category="stratuslab" class="com.sixsq.slipstream.persistence.ModuleParameter" description="VM disks bus type" isSet="true" mandatory="true" name="stratuslab.disks.bus.type" readonly="false" type="Enum">
                        <enumValues length="2">
                           <string>virtio</string>
                           <string>scsi</string>
                        </enumValues>
                        <value>virtio</value>
                        <defaultValue>virtio</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>admin_password</string>
                     <parameter category="Input" class="com.sixsq.slipstream.persistence.ModuleParameter" description="admin password" isSet="false" mandatory="false" name="admin_password" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>LLR.ram</string>
                     <parameter category="LLR" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Requested RAM (in GB)" isSet="false" mandatory="true" name="LLR.ram" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>interoute.login.password</string>
                     <parameter category="interoute" class="com.sixsq.slipstream.persistence.ModuleParameter" description="SSH login password for the image" isSet="true" mandatory="false" name="interoute.login.password" readonly="false" type="Password">
                        <value>rootpass</value>
                        <defaultValue>rootpass</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>network</string>
                     <parameter category="Cloud" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Network type" isSet="true" mandatory="true" name="network" readonly="false" type="Enum">
                        <enumValues length="2">
                           <string>Public</string>
                           <string>Private</string>
                        </enumValues>
                        <value>Public</value>
                        <defaultValue>Public</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>LLR.instance.type</string>
                     <parameter category="LLR" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Cloud instance type" isSet="true" mandatory="true" name="LLR.instance.type" readonly="false" type="Enum">
                        <enumValues length="7">
                           <string>m1.small</string>
                           <string>c1.medium</string>
                           <string>m1.large</string>
                           <string>m1.xlarge</string>
                           <string>c1.xlarge</string>
                           <string>t1.micro</string>
                           <string>standard.xsmall</string>
                        </enumValues>
                        <value>m1.small</value>
                        <defaultValue>m1.small</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>CC-IN2P3.security.groups</string>
                     <parameter category="CC-IN2P3" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="CC-IN2P3.security.groups" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>interoute.ram</string>
                     <parameter category="interoute" class="com.sixsq.slipstream.persistence.ModuleParameter" description="RAM in GB" isSet="true" mandatory="false" name="interoute.ram" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>cloudsigma.cpu</string>
                     <parameter category="cloudsigma" class="com.sixsq.slipstream.persistence.ModuleParameter" description="CPU in GHz" isSet="true" mandatory="false" name="cloudsigma.cpu" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>atos.instance.type</string>
                     <parameter category="atos" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Cloud instance type" isSet="false" mandatory="false" name="atos.instance.type" readonly="false" type="Enum" />
                  </entry>
                  <entry>
                     <string>LLR.disks.bus.type</string>
                     <parameter category="LLR" class="com.sixsq.slipstream.persistence.ModuleParameter" description="VM disks bus type" isSet="true" mandatory="true" name="LLR.disks.bus.type" readonly="false" type="Enum">
                        <enumValues length="2">
                           <string>virtio</string>
                           <string>scsi</string>
                        </enumValues>
                        <value>virtio</value>
                        <defaultValue>virtio</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>extra.disk.volatile</string>
                     <parameter category="Cloud" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Volatile extra disk in GB" isSet="false" mandatory="true" name="extra.disk.volatile" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>CC-IN2P3.instance.type</string>
                     <parameter category="CC-IN2P3" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Instance type (flavor)" isSet="true" mandatory="true" name="CC-IN2P3.instance.type" readonly="false" type="String">
                        <value>m1.tiny</value>
                        <defaultValue>m1.tiny</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>mysql_password</string>
                     <parameter category="Input" class="com.sixsq.slipstream.persistence.ModuleParameter" description="MySQL password" isSet="false" mandatory="false" name="mysql_password" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>cloudsigma.ram</string>
                     <parameter category="cloudsigma" class="com.sixsq.slipstream.persistence.ModuleParameter" description="RAM in GB" isSet="true" mandatory="false" name="cloudsigma.ram" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>wordpress_title</string>
                     <parameter category="Input" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Title (name) to give to the WordPress instance" isSet="false" mandatory="false" name="wordpress_title" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>stratuslab.instance.type</string>
                     <parameter category="stratuslab" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Cloud instance type" isSet="true" mandatory="true" name="stratuslab.instance.type" readonly="false" type="Enum">
                        <enumValues length="7">
                           <string>m1.small</string>
                           <string>c1.medium</string>
                           <string>m1.large</string>
                           <string>m1.xlarge</string>
                           <string>c1.xlarge</string>
                           <string>t1.micro</string>
                           <string>standard.xsmall</string>
                        </enumValues>
                        <value>m1.small</value>
                        <defaultValue>m1.small</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>LLR.cpu</string>
                     <parameter category="LLR" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Requested CPUs" isSet="false" mandatory="true" name="LLR.cpu" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>hostname</string>
                     <parameter category="Output" class="com.sixsq.slipstream.persistence.ModuleParameter" description="hostname/ip of the image" isSet="false" mandatory="true" name="hostname" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>cloudsigma.login.password</string>
                     <parameter category="cloudsigma" class="com.sixsq.slipstream.persistence.ModuleParameter" description="SSH login password for the image" isSet="true" mandatory="false" name="cloudsigma.login.password" readonly="false" type="Password">
                        <value>ubuntupass</value>
                        <defaultValue>ubuntupass</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>admin_email</string>
                     <parameter category="Input" class="com.sixsq.slipstream.persistence.ModuleParameter" description="admin email" isSet="false" mandatory="false" name="admin_email" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>atos.ram</string>
                     <parameter category="atos" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Requested RAM (in GB)" isSet="true" mandatory="false" name="atos.ram" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>stratuslab.ram</string>
                     <parameter category="stratuslab" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Requested RAM (in GB)" isSet="true" mandatory="true" name="stratuslab.ram" readonly="false" type="String">
                        <value>2</value>
                        <defaultValue>2</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>atos.cpu</string>
                     <parameter category="atos" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Requested CPUs" isSet="true" mandatory="false" name="atos.cpu" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>atos.disks.bus.type</string>
                     <parameter category="atos" class="com.sixsq.slipstream.persistence.ModuleParameter" description="VM disks bus type" isSet="false" mandatory="false" name="atos.disks.bus.type" readonly="false" type="Enum" />
                  </entry>
                  <entry>
                     <string>interoute.cpu</string>
                     <parameter category="interoute" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Number of CPUs" isSet="true" mandatory="false" name="interoute.cpu" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>cloudsigma.smp</string>
                     <parameter category="cloudsigma" class="com.sixsq.slipstream.persistence.ModuleParameter" description="SMP (number of virtual CPUs)" isSet="true" mandatory="false" name="cloudsigma.smp" readonly="false" type="String">
                        <value>1</value>
                        <defaultValue>1</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>stratuslab.cpu</string>
                     <parameter category="stratuslab" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Requested CPUs" isSet="true" mandatory="true" name="stratuslab.cpu" readonly="false" type="String">
                        <value>2</value>
                        <defaultValue>2</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>interoute.network</string>
                     <parameter category="interoute" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Network types to start the image on" isSet="false" mandatory="false" name="interoute.network" readonly="false" type="Enum" />
                  </entry>
                  <entry>
                     <string>instanceid</string>
                     <parameter category="Output" class="com.sixsq.slipstream.persistence.ModuleParameter" description="Cloud instance id" isSet="false" mandatory="true" name="instanceid" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>admin_username</string>
                     <parameter category="Input" class="com.sixsq.slipstream.persistence.ModuleParameter" description="admin username" isSet="true" mandatory="false" name="admin_username" readonly="false" type="String">
                        <value>admin</value>
                        <defaultValue>admin</defaultValue>
                     </parameter>
                  </entry>
               </parameters>
               <authz groupCreateChildren="false" groupDelete="false" groupGet="true" groupPost="true" groupPut="false" inheritedGroupMembers="true" owner="sixsq" ownerCreateChildren="true" ownerDelete="true" ownerGet="true" ownerPost="true" ownerPut="true" publicCreateChildren="false" publicDelete="false" publicGet="false" publicPost="false" publicPut="false">
                  <groupMembers class="java.util.ArrayList" />
               </authz>
               <commit author="sixsq" />
               <targets class="org.hibernate.collection.PersistentBag">
                  <target name="execute" runInBackground="false">#!/bin/sh

set -e

ss-display "Updating package index"
apt-get clean
apt-get update

ss-display "Installing Puppet client"

apt-get install -y puppet-common
apt-get install -y rubygems
gem install puppet-module

ss-display "Installing WordPress manifest"
cd /etc/puppet/modules/
puppet module install jonhadfield/wordpress

export admin_username=`ss-get admin_username`
export admin_password=`ss-get admin_password`
export admin_email=`ss-get admin_email`
export wordpress_title=`ss-get wordpress_title`
export FACTER_mysql_password=`ss-get mysql_password`
export public_hostname=`ss-get hostname`


cd /etc/puppet/manifests/

cat &gt; wp.pp &lt;&lt; 'EOF'
class { 'wordpress':
  wordpress_db_password =&gt; $::mysql_password,
}
EOF

cat &gt; init.pp &lt;&lt; 'EOF'
exec { 'Perform initial wordpress configuration':
  command =&gt; 'wp-init.sh',
  path    =&gt; ['/etc/puppet/manifests'],
}
EOF

cat &gt; wp-init.sh &lt;&lt; 'EOF'
#!/bin/bash
set -e

data="weblog_title=${wordpress_title}&amp;user_name=${admin_username}&amp;admin_password=${admin_password}&amp;admin_password2=${admin_password}&amp;admin_email=${admin_email}&amp;blog_public=1"
base_url=http://${public_hostname}
url=${base_url}/wp-admin/install.php\?step=2

/usr/bin/curl --data ${data} ${url} &gt;&gt; /tmp/curl.out

EOF

chmod +x wp-init.sh

ss-display "Installing WordPress"

puppet apply -v wp.pp

ss-display "Configuring WordPress"

puppet apply -v init.pp

ss-display "WordPress ready to go!"
</target>
               </targets>
               <packages class="org.hibernate.collection.PersistentBag" />
               <prerecipe />
               <recipe />
               <cloudImageIdentifiers class="org.hibernate.collection.PersistentBag">
                  <cloudImageIdentifier cloudImageIdentifier="KBhcU87Wm5IZNOXZYGHrczGekwp" cloudServiceName="stratuslab" />
               </cloudImageIdentifiers>
               <extraDisks class="org.hibernate.collection.PersistentBag" />
            </image>
         </node>
      </entry>
   </nodes>
</deploymentModule>